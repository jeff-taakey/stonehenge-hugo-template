{{ if .Params.tags }}
<section class="related-posts mt-12">
  <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-200">
    Related Articles
  </h2>
  <ul class="space-y-4 text-lg">
    {{ $page := . }}
    {{ $currentDir := .File.Dir }} {{/* 获取当前文章所在的目录，如 content/aws/saa-c03/ */}}
    {{ $bestMatches := slice }}

    {{/* 仅在同一级目录下查找相关文章 */}}
    {{ range where site.RegularPages "File.Dir" "==" $currentDir }}
      {{ if ne .Permalink $page.Permalink }}
        {{ $commonTags := intersect .Params.tags $page.Params.tags }}
        {{ $commonCats := intersect .Params.categories $page.Params.categories | default (slice) }}
        
        {{/* 计算匹配分数：标签匹配得 1 分，分类匹配得 2 分 */}}
        {{ $score := add (len $commonTags) (mul (len $commonCats) 2) }}
        
        {{/* 如果在同一认证目录下，即便标签不完全一致也给予基础分以保证推荐 */}}
        {{ $score = add $score 1 }}

        {{ $bestMatches = $bestMatches | append (dict "page" . "score" $score) }}
      {{ end }}
    {{ end }}

    {{ $bestMatches = sort $bestMatches "score" "desc" }}
    {{ $count := len $bestMatches }}

    {{ if gt $count 0 }}
      {{ range first 5 $bestMatches }}
        <li class="flex items-baseline leading-relaxed py-1">
          <span class="w-6 shrink-0 text-gray-600 dark:text-gray-400 select-none">·</span>
          <a href="{{ .page.Permalink }}"
             class="text-blue-600 dark:text-blue-400 hover:underline hover:text-blue-800 dark:hover:text-blue-300 transition-colors duration-200">
            {{ .page.Title }}
          </a>
        </li>
      {{ end }}
    {{ else }}
      <li class="flex items-baseline text-gray-500 dark:text-gray-400 italic py-1">
        <span class="w-6 shrink-0 text-gray-600 dark:text-gray-400 select-none">·</span>
        Stay tuned for more {{ path.Base $currentDir | upper }} resources.
      </li>
    {{ end }}
  </ul>
</section>
{{ end }}